<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
  <title>YOLO Annotator</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
</head>
<body>
  <div class="app-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
      <h1>YOLO Annotator</h1>
      
      <!-- Folder Selection -->
      <section class="panel">
        <h3>ğŸ“ Image Folder</h3>
        <button id="btn-browse" class="browse-btn">ğŸ“‚ Select Folder</button>
        <div class="folder-display" id="folder-display">No folder selected</div>
        <span id="folder-status"></span>
      </section>
      
      <!-- Class Management -->
      <section class="panel">
        <h3>ğŸ·ï¸ Classes</h3>
        <div class="class-list" id="class-list"></div>
        <div class="class-add">
          <input type="text" id="new-class" placeholder="Add class...">
          <button id="btn-add-class">+</button>
        </div>
        <div class="current-class">
          Active: <span id="active-class">None</span>
        </div>
      </section>
      
      <!-- Tools -->
      <section class="panel">
        <h3>ğŸ”§ Tools</h3>
        <div class="toolbar">
          <button id="tool-bbox" class="tool-btn active" title="Bounding Box [B]">â˜ BBox</button>
          <button id="tool-pan" class="tool-btn" title="Pan [Space]">âœ‹ Pan</button>
        </div>
        <div class="toolbar">
          <button id="btn-repeat" title="Repeat last annotation">ğŸ” Repeat</button>
          <button id="btn-undo" title="Undo [Ctrl+Z]">â†© Undo</button>
          <button id="btn-redo" title="Redo [Ctrl+Y]">â†ª Redo</button>
        </div>
      </section>
      
      <!-- Export Filters -->
      <section class="panel">
        <h3>ğŸ¨ Export Filters</h3>
        <div class="filter-control">
          <label>Brightness: <span id="v-brightness">1.0</span></label>
          <input type="range" id="filter-brightness" min="0.5" max="2.0" step="0.1" value="1.0">
        </div>
        <div class="filter-control">
          <label>Saturation: <span id="v-saturation">1.0</span></label>
          <input type="range" id="filter-saturation" min="0.0" max="2.0" step="0.1" value="1.0">
        </div>
        <div class="filter-control">
          <label>Exposure: <span id="v-exposure">1.0</span></label>
          <input type="range" id="filter-exposure" min="0.5" max="2.0" step="0.1" value="1.0">
        </div>
        <div class="filter-control">
          <label>Blur: <span id="v-blur">0</span></label>
          <input type="range" id="filter-blur" min="0" max="5" step="0.5" value="0">
        </div>
        <div class="filter-control">
          <label><input type="checkbox" id="filter-grayscale"> Grayscale</label>
        </div>
      </section>
      
      <!-- Export Settings -->
      <section class="panel">
        <h3>ğŸ“¦ Export</h3>
        <div class="export-control">
          <label>Model Preset:</label>
          <select id="model-preset">
            <option value="yolov5s">YOLOv5 (640)</option>
            <option value="yolov5_416">YOLOv5 (416)</option>
            <option value="yolov8n" selected>YOLOv8 (640)</option>
            <option value="yolov8_1280">YOLOv8 (1280)</option>
            <option value="yolov11n">YOLOv11 (640)</option>
          </select>
        </div>
        <div class="export-control">
          <label>Train/Val Split: <span id="v-split">80</span>%</label>
          <input type="range" id="train-split" min="50" max="100" step="5" value="80">
        </div>
        <div class="export-buttons">
          <button id="btn-validate" class="secondary">ğŸ” Validate</button>
          <button id="btn-export" class="primary">â¬‡ Export ZIP</button>
        </div>
      </section>
      
      <!-- Navigation -->
      <section class="panel">
        <h3>ğŸ–¼ï¸ Navigation</h3>
        <button id="btn-gallery">ğŸ“Š View Gallery</button>
        <div class="nav-info">
          <span id="img-counter">0 / 0</span>
        </div>
        <div class="nav-buttons">
          <button id="btn-prev">â† Prev</button>
          <button id="btn-next">Next â†’</button>
        </div>
      </section>
    </aside>
    
    <!-- Main Workspace -->
    <main class="workspace">
      <!-- Editor View -->
      <div id="editor-view">
        <div id="canvas-container">
          <canvas id="canvas"></canvas>
        </div>
        <footer class="status-bar">
          <span id="status-file">No image loaded</span>
          <span id="status-coords">X: 0, Y: 0</span>
          <span id="status-zoom">Zoom: 100%</span>
          <span id="status-save">â—</span>
        </footer>
      </div>
      
      <!-- Gallery View -->
      <div id="gallery-view" class="hidden">
        <header class="gallery-header">
          <h2>Project Gallery</h2>
          <div class="gallery-stats">
            <span id="stat-total">0 images</span>
            <span id="stat-annotated">0 annotated</span>
            <span id="stat-pending">0 pending</span>
          </div>
          <button id="btn-back-editor">â† Back to Editor</button>
        </header>
        <div class="gallery-grid" id="gallery-container"></div>
      </div>
      
      <!-- Validation Modal -->
      <div id="validation-modal" class="modal hidden">
        <div class="modal-content">
          <header>
            <h3>Validation Preview</h3>
            <button id="btn-close-modal">âœ•</button>
          </header>
          <div class="validation-image">
            <img id="validation-img" src="" alt="Validation Preview">
          </div>
          <p class="validation-info">Bounding boxes shown on letterboxed image at export resolution.</p>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Scripts -->
  <script src="js/state.js"></script>
  <script src="js/history.js"></script>
  <script src="js/classes.js"></script>
  <script src="js/canvas.js"></script>
  <script src="js/bbox.js"></script>
  <script src="js/gallery.js"></script>
  <script src="js/validator.js"></script>
  <script src="js/exporter.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
